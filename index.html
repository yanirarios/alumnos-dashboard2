<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Alumnos</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; padding: 10px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
  </style>
</head>
<body>

<h1>Dashboard Alumnos (Firebase + Local)</h1>

<button id="syncDown">Sincronizar ↓ (desde Firebase)</button>
<button id="syncUp">Sincronizar ↑ (a Firebase)</button>

<h2>Agregar Alumno</h2>
<input id="nombre" placeholder="Nombre" />
<input id="curso" placeholder="Curso" />
<button id="add">Agregar</button>

<h2>Listado</h2>
<table id="tabla">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Curso</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>

<script>
/* ---------------------------------------------------------
   CONFIGURACIÓN FIREBASE (CAMBIAR ESTO)
--------------------------------------------------------- */

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE_BUCKET",
  messagingSenderId: "TU_SENDER_ID",
  appId: "TU_APP_ID"
};

// Inicializar Firebase
const app = firebase.initializeApp(firebaseConfig);
const db  = firebase.firestore();


/* ---------------------------------------------------------
   LOCAL DATA (fallback cuando no hay firebaseConfig)
--------------------------------------------------------- */
let datos = JSON.parse(localStorage.getItem("alumnos")) || [];

function guardarLocal() {
  localStorage.setItem("alumnos", JSON.stringify(datos));
}


/* ---------------------------------------------------------
   DIBUJAR TABLA
--------------------------------------------------------- */
function dibujar() {
  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  datos.forEach((alumno, index) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${alumno.nombre}</td>
      <td>${alumno.curso}</td>
      <td>
        <button onclick="eliminar(${index})">Borrar</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

window.eliminar = (i) => {
  datos.splice(i, 1);
  guardarLocal();
  dibujar();
};


/* ---------------------------------------------------------
   AGREGAR ALUMNO LOCAL
--------------------------------------------------------- */
document.getElementById("add").onclick = () => {
  const nombre = document.getElementById("nombre").value;
  const curso  = document.getElementById("curso").value;

  if (!nombre || !curso) {
    alert("Falta completar datos");
    return;
  }

  datos.push({ nombre, curso });
  guardarLocal();
  dibujar();

  document.getElementById("nombre").value = "";
  document.getElementById("curso").value  = "";
};


/* ---------------------------------------------------------
   SINCRONIZAR ↓ (descargar de Firebase)
--------------------------------------------------------- */
document.getElementById("syncDown").onclick = async () => {
  const snap = await db.collection("Alumnos").get();
  
  datos = snap.docs.map(doc => doc.data());
  guardarLocal();
  dibujar();

  alert("Datos descargados desde Firebase ✔");
};


/* ---------------------------------------------------------
   SINCRONIZAR ↑ (subir a Firebase)
--------------------------------------------------------- */
document.getElementById("syncUp").onclick = async () => {
  // Borrar colección antes de subir
  const snap = await db.collection("Alumnos").get();
  const batch = db.batch();

  snap.forEach(doc => batch.delete(doc.ref));
  await batch.commit();

  // Subir datos locales
  const batch2 = db.batch();
  
  datos.forEach((al) => {
    const ref = db.collection("Alumnos").doc();
    batch2.set(ref, al);
  });

  await batch2.commit();

  alert("Datos subidos a Firebase ✔");
};


/* ---------------------------------------------------------
   CARGAR INICIAL
--------------------------------------------------------- */
dibujar();
</script>

</body>
</html>
